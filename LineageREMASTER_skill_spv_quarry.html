<!DOCTYPE html>
<html lang="ja">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>リネージュリマスター・スキル一覧</title>
    <meta name="description" content="">
    <meta name="keywords" content="">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.3/normalize.css">
    <!-- <link rel="stylesheet" href="normalize.css"> -->
    <!-- アイコンフォントの利用方法 http://fortawesome.github.io/Font-Awesome/ -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <!-- <link rel="stylesheet" href="font-awesome.min.css"> -->
    <link rel="stylesheet" href="Lineage_main.css">

    <!-- <script src="jquery.min.js"></script> -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="Lineage_main.css">
    <style>
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            margin: -1px;
            padding: 0;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }
       table {
            width: 100%;
            border-collapse: collapse;
            background-color: #ffffff;
        }
        .child-table {
            border-collapse: collapse;
            background-color: #ffffff;
            font-size:xx-small;
        }
        tr.record-table{
            background-color: #ffffff;
            border-color:#ffffff
        }
        th {
            background-color: #f2f2f2;
            border: 1px solid #ccc;
            padding: 6px;
            text-align: left;
            font-size: small;
            font-weight: normal;
        }
        td {
            border: 1px solid #ccc;
            padding: 6px;
            text-align: left;
            font-size: small;
            font-weight: normal;
        }
        .row-header {
            background-color: #f2f2f2;
            font-weight:normal;
            font-size:smaller;
            min-width:30px;
        }
        .row-header_skillname {
            background-color: #f2f2f2;
            font-weight:normal;
            font-size:smaller;
            width: calc(100% - 5 * 100px);
            min-width:60px;
        }
        .row-data {
            background-color: #ffffff;
            min-width:60px;
        }
        .col-header {
            background-color: #f2f2f2;
            min-width:80px;
            font-weight:normal;
            font-size:smaller;
        }
        .col-data {
            background-color: #ffffff;
            min-width:80px;
        }
        .col-data_no {
            background-color: #edf;
            width:60px;
            border-right-color: #edf;
            font-size: small;
        }
        .col-data_level {
            background-color: #edf;
            width: 60px;
            border-left-color: #edf;
            border-right-color: #edf;
            font-size: medium;
        }
        .col-data_skillname {
            background-color: #edf;
            width: calc(100% - 5 * 100px);
            min-width:300px;
            border-left-color: #edf;
            font-size: medium;
        }
    .footer-text {
        margin-bottom: 6px;
        color: #999;
        font-size: 0.8em;
    }

    .footer-copyright {
        color: #000;
        font-size: 0.8em;
    }
    #user_operation {
    padding: 0.5em 0;
    margin-bottom: 1em;
    }

    #classFilterBtns {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5em;
    }
    @media (max-width: calc(100% - 30px)) {
        .spv-col-header {
            width: 50px;
        }
        .spv-col-header-cost {
            width:50px;
        }
        .spv-col-data_no {
            width:50px;
        }
        .spv-col-data {
            width:calc(100% - 50px);
        }
        .spv-col-data_level {
            width:50px;
        }
        .spv-col-data_mp {
            width:50px
        }
        .spv-col-data_hp {
            width:50px;
        }
        .spv-col-data_material {
            width:calc(100% - 265px);
        }
    }
/* スマホ用メディアクエリ対応 2025-06-22-16:40 */
/* thtdの繰り返しとなって空白が多くスクロールが増えるのでjsによりtrthtdtrthtdにする   */
/* 2025-06-23 6:00 */
/* if (window.innerWidth <= 398) 判定によりthtdテーブル構造をスマホ版とPC版で切り分け　
    @media (max-width: 398px) {
        .record-table table,
        .record-table tr,
        .record-table td,
        .record-table th {
            display: block;
            width: 100%;
            font-size: 1em;
    }
    }
    @media (max-width: 600px) {
        .record-table > td {
        padding: 0;
        }
        .record-table table,
        .record-table tr,
        .record-table td,
        .record-table th {
            display: block;
            width: 100%;
        }
        .record-table {
            margin-bottom: 1.5em;
            border-radius: 8px;
            box-shadow: 0 2px 6px #eee;
            overflow: hidden;
        }
        .col-data_skillname {
            font-size: 1.1em;
            font-weight: bold;
            background: #eaf6ff;
            margin-bottom: 6px;
        }
    }*/
    </style>
</head>
<body id="top">
    <div class="nav">
        <ul class="nav-group">
            <li><a href="index.html">ホーム</a><i class="fa fa-home"></i></li>
            <li><a href="Lineage_table_monster.html">MonsterList</a></li>
            <li><a href="Lineage_table_drop.html">DropList</a></li>
            <li><a href="LineageREMASTER_skill_spv.html" class="active">&nbsp;SkillList</a></li>
            <li><a href="LineageREMASTER_IME.html">IME</a></li>
            <li><a href="LineageREMASTER_ATOK.html">ATOK</a></li>
            <li><a href="LineageREMASTERED_etc.html">諸表</a></li>
            <li><a href="font.html">大字</a></li>
        </ul>
    </div>
<!-- ページ冒頭に非表示で読み上げ対応の国際化・説明テキスト -->
    <p id="screenreader-info" lang="en">
        This page lists MMORPG skills for Japanese-speaking players. It does not contain navigation or language switching. If you are using a screen reader or are not fluent in Japanese, please note that this page is for reference only and may not offer interactive support.
    </p>
<!-- 日本語でのページ説明（視認表示可） -->
    <p id="screenreader-info_jp" class="page-description">
        このページは日本語話者向けに設計されたMMORPGスキルの一覧表です。リンクやナビゲーション機能は設けておらず、ページ全体の内容を1ページで完結する構成になっています。内容の把握を主目的としています。
    </p>
<!-- 技術・魔法一覧のインポート(旧仕様)※スマホでは取得できないから 
 <input type="file" id="fileInput">
-->
<!-- 技術・魔法一覧のインポート(前仕様)※ファイル全体のペースト(長大なデータでは不適当) -->
<!-- <button id="submitBtn">表示</button>
     <div id="output"></div>
-->
<!-- 技術・魔法一覧のインポート(新仕様)※ファイル名のハードコーディング -->
    <div id="user_operation">
        <button id="loadBtn" class="btn-visual" data-cls="all">表示</button>
<!-- HTML（ボタンやセレクトボックスを追加） -->
        <div id="classFilterBtns">
<!--         <button class="class-btn" data-cls="all">全て</button> -->
            <button class="class-btn btn-visual" data-cls="君">君</button>
            <button class="class-btn btn-visual" data-cls="騎">騎</button>
            <button class="class-btn btn-visual" data-cls="妖">妖</button>
            <button class="class-btn btn-visual" data-cls="魔">魔</button>
            <button class="class-btn btn-visual" data-cls="闇">闇</button>
            <button class="class-btn btn-visual" data-cls="竜">竜</button>
            <button class="class-btn btn-visual" data-cls="闘">闘</button>
            <button class="class-btn btn-visual" data-cls="剣">剣</button>
            <button class="class-btn btn-visual" data-cls="槍">槍</button>
            <button class="class-btn btn-visual" data-cls="闘">闘</button>
            <button class="class-btn btn-visual" data-cls="幻">幻</button>
            <button class="class-btn btn-visual" data-cls="聖">聖</button>
        </div>
    </div>
<!-- 技術・魔法一覧の表示 -->    
    <div id="result"></div>
<!-- 脚注・権利表記 -->
    <div class="footer-text">
        <footer role="contentinfo">
            <section lang="ja">
                <small>当サイトで使用されているリネージュの画像・BGM及びその他の表現物の権利は下記のとおり権利者に帰属します：</small>
            </section>
            <section lang="en">
                <small>Lineage and Lineage Eternal Life are registered trademarks of NCsoft Corporation.&copy;  1998-2011 Copyright NCsoft Corporation. NC Japan K.K. was granted by NCsoft Corporation the right to publish, distribute, and transmit Lineage Eternal Life in Japan. All Rights Reserved.</small>
            </section>
            <section lang="zh-TW">
                <small>本頁面使用之《Lineage》相關素材，其版權皆屬原創作者所有。</small>
            </section>
        </footer>
    </div>
<!-- FC2ではapplication/scriptでもjsファイル読み込み時にtext/htmlに帰られて駆動しない -->
<!--    <script src="lineage_skill.js" defer></script> -->
<script>
// スクリプトの読み込みを待つためのDOMContentLoadedイベントリスナー
    document.addEventListener('DOMContentLoaded', function() {
        console.log("DOM読み込み完了");
    });
// document.getElementById('fileInput').addEventListener('change', function(e) {
//スマホでは無理だからTSV選択はさせない。TSVファイル名のハードコーディング。
document.getElementById('loadBtn').addEventListener('click', function() {
// 英文説明/日本語説明をスクリーンリーダー向けの非表示スタイルを付加
    const info_en = document.getElementById("screenreader-info");
    const info_jp = document.getElementById("screenreader-info_jp");
// 非表示クラスを付加（すでに付いていなければ）
    if (!info_en.classList.contains("sr-only")) {
        info_en.classList.add("sr-only");
    }
    if (!info_jp.classList.contains("sr-only")) {
        info_jp.classList.add("sr-only");
    }
// url掃除ページロード時をイベントとして処理するのは宿題。今は表示ボタンがトリガー。
// 表示されていない状態なのに #class=xxx があるならハッシュを消す
    if (!document.getElementById('result').innerHTML && location.hash.includes("class=")) {
        history.replaceState(null, null, location.pathname);
    }
// TSV読み込みと描画 タイムスタンプを附与したリクエストによる強制再読み込みによって、FC2Serverのキャッシュ寿命を回避。
    fetch('LineageREMASTER_skill3.txt?v=' + new Date().getTime())
        .then(response => response.text())
        .then(text => {
//test用
// 読み込み成功時の処理
console.log("スクリプト開始");
console.log("DOM読み込み待機中");
//
//document.addEventListener('DOMContentLoaded', () => {
//  console.log("DOM読み込み完了");
//
//  const btn = document.getElementById('loadBtn');
//  if (btn) {
//    console.log("ボタン取得成功");
//    btn.addEventListener('click', () => {
//      console.log("ボタンクリック");
//      fetch('LineageREMASTER_skill3.txt?v=' + new Date().getTime())
//        .then(response => {
//          if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
//          return response.text();
//        })
//        .then(text => {
//          console.log("読み込み成功");
//          document.getElementById('result').textContent = text;
//        })
//        .catch(error => {
//          console.error("読み込みエラー:", error);
//        });
//    });
//  } else {
//    console.log("loadBtn 見つからず");
//  }
//});
function setup() {
  console.log("setup開始");
  const btn = document.getElementById('loadBtn'); // 開始ボタン=loadBtn
  if (btn) {
// ↓デバッグ用コンソールへテスト用テキストの送出。
    console.log("ボタン取得成功");
    btn.addEventListener('click', () => {
      console.log("ボタンクリックされました");
    if (typeof test === "string") {
        console.log("testの先頭100文字:", test.slice(0, 100));
    } else {
        console.log("表示ボタンが押されました");
    }
// ↑デバッグ用コンソールへテスト用テキストの送出。
// 開始ボタンと全てボタン分離。
    let quarry = null;
    let alreadyFetched = false;

    const loadBtn = document.getElementById("loadBtn");
    loadBtn.addEventListener("click", () => {
    if (alreadyFetched && quarry) {
        console.log("再描画のみ：fetchせず");
        renderTable(parseTSV(quarry));
    } else {
        console.log("初回fetch開始");
        fetch("LineageREMASTER_skill3.txt?v=" + Date.now())
        .then(res => res.text())
        .then(tsv => {
            quarry = tsv;
            alreadyFetched = true;
            renderTable(parseTSV(quarry));
        })
        .catch(err => {
            console.error("読み込み失敗:", err);
        });
    }
    });

// タイムスタンプを附与したリクエストによる強制再読み込みによって、FC2Serverのキャッシュ寿命を回避。
      fetch('LineageREMASTER_skill3.txt?v=' + new Date().getTime())
        .then(response => {
          if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
          return response.text();
        })
        .then(text => {
          console.log("読み込み成功");
          document.getElementById('result').textContent = text;
        })
        .catch(error => {
          console.error("読み込みエラー:", error);
        });
    });
  } else {
    console.log("loadBtn 見つからず");
  }
}
// DOMContentLoaded イベントを使用して、DOMの読み込み完了を待つ
if (document.readyState === 'loading') {
  console.log("DOM読み込み待機中");
  document.addEventListener('DOMContentLoaded', setup);
} else {
  console.log("DOMすでに構築済み、即時実行");
  setup();
}

// Windowサイズによって表示を切り替える
window.addEventListener('DOMContentLoaded', function() {
  if (window.innerWidth <= 398) {
    document.querySelectorAll('.record-table table').forEach(table => {
      table.querySelectorAll('tr').forEach(tr => {
        const cells = Array.from(tr.children);
        if (cells.length > 2) {
          let newRows = [];
          for (let i = 0; i < cells.length; i += 2) {
            let newTr = document.createElement('tr');
            if (cells[i]) newTr.appendChild(cells[i].cloneNode(true));
            if (cells[i+1]) newTr.appendChild(cells[i+1].cloneNode(true));
            newRows.push(newTr);
          }
          let parent = tr.parentNode;
          parent.insertBefore(newRows[0], tr);
          for (let i = 1; i < newRows.length; i++) {
            parent.insertBefore(newRows[i], newRows[i-1].nextSibling);
          }
          parent.removeChild(tr);
        }
      });
    });
  }
});
// 必要ならここでparseTSV(text)などの処理を呼び出す
// document.getElementById('submitBtn').addEventListener('click', function() {
//     const text = document.getElementById('textInput').value;
//     parseTSV(text);
// });
// function parseTSV(text) {
// ここにTSVパース＆表示処理を書く
//    const reader = new FileReader();
//     reader.onload = function() {
        const lines = text.trim().split('\n');
        let html = `<table>`;
        for (const line of lines) {
            const fields = line.split('\t');
            console.log(`フィールド数(${line}):`, fields.length); // フィールド数を確認

            if (fields.length < 24) {
                console.warn("データ不足:", fields);
                continue; // フィールド数が不足している場合スキップ
            }
            const [no,img,level,name,cls,elf,active,type,align,mp,hp,material,duration,target,reuse,effect,acqLv,obtain,price,Droporigin,Dropcomp,note1,note2,EOR] = line.split('\t');

            // 各フィールドをTAB分割 EOR(End Of Record)を無視
            // imgは画像のURLだが、ここでは使用しないので無視。値は"全角Space"
            // EORは行の終わりを示すが、ここでは使用しないので無視。値は"■"
            // clsとelfのまとめ表示
            let clsDisplay = cls;
            if (cls === "妖" && elf) {
                clsDisplay += `（${elf}）`;
            }
// 各フィールドの値を変数に格納
            if (window.innerWidth <= 450) {
// #region sauce
//  --- スマホ用テーブル出力 ---
                html += `<tbody>`//<tr class="spv-record-table" data-cls="${cls}"><td colspan="6">`;
                html += `<tr><td class="spv-col-data_no">No.${no}</td><td class="spv-col-data_level">${level}</td>`;
                html += `<td class="spv-col-data_skillname" colspan="5">${name}</td></tr>`;
                html += `<tr><th class="spv-col-header">クラス</th><td class="spv-col-data" colspan="5">${clsDisplay}</td></tr>`;
                html += `<tr><th class="spv-col-header">活性</th><td class="spv-col-data" colspan="5">${active}</td></tr>`;
                html += `<tr><th class="spv-col-header">種類</th><td class="spv-col-data" colspan="5">${type}</td></tr>`;
                html += `<tr><th class="spv-col-header">性向</th><td class="spv-col-data" colspan="5">${align}</td></tr>`;
                html += `<tr class="slkill_cost"><th class="spv-col-header-cost">消耗MP</th><td class="spv-col-data-mp">${mp}</td>`;
                html += `<th class="spv-col-header-cost">消耗HP</th><td class="spv-col-data-hp">${hp}</td>`;
                html += `<th class="spv-col-header-cost">材料触媒</th><td class="spv-col-data-material">${material}</td></tr>`;
                html += `<tr><th class="spv-col-header">持続時間</th><td class="spv-col-data" colspan="5">${duration}</td></tr>`;
                html += `<tr><th class="spv-col-header">対象</th><td class="spv-col-data" colspan="5">${target}</td></tr>`;
                html += `<tr><th class="spv-col-header">再使用秒</th><td class="spv-col-data" colspan="5">${reuse}</td></tr>`;
                html += `<tr><th class="spv-col-header">効果性能</th><td class="spv-col-data" colspan="5">${effect}</td></tr>`;
                html += `<tr><th class="spv-col-header">習得Lv.</th><td class="spv-col-data" colspan="5">${acqLv}</td></tr>`;
                html += `<tr><th class="spv-col-header">取得方法</th><td class="spv-col-data" colspan="5">${obtain}</td></tr>`;
                html += `<tr><th class="spv-col-header">価格</th><td class="spv-col-data" colspan="5">${price}</td></tr>`;
                html += `<tr><th class="spv-col-header">ドロップ</th><td class="spv-col-data" colspan="5">${Droporigin}</td></tr>`;
                html += `<tr><th class="spv-col-header">【蘇生】</th><td class="spv-col-data" colspan="5">${Dropcomp}</td></tr>`;
                html += `<tr><th class="spv-col-header">備考1</th><td class="spv-col-data" colspan="5">${note1}</td></tr>`;
                html += `<tr><th class="spv-col-header">備考2</th><td class="spv-col-data" colspan="5">${note2}</td></tr>`;
                // html += `</td></tr>`;
                html += `</tbody>`;
            } else {
// #endregion
//  --- PC用テーブル出力 ---
            html += `<tbody class="record-table" data-cls="${cls}">`
            // No.とLevelとスキル名は「<th>～」を使用しない。
                html += `<tr>
                            <td class="col-data_no">No.${no}</td>`
                // ...existing code...
                // 等級・スキルレベルの出力部分
                            if (/^\d+$/.test(level)) {
                    // 数字のみの場合
                                html += `<td class="col-data_level">Lv.${level}</td>`;
                            } else {
                    // 空または文字列（神話・伝説など）の場合
                                html += `<td class="col-data_level">${level}</td>`;
                            }   
                 //            <th class="col-header" colspan="2">等級・スキルレベル</th><td class="col-data">${level}</td>
                    html += `<td class="col-data_skillname" colspan="9">${name}</td>
                        </tr>`
                html += `<tr>
                            <th class="col-header">習得クラス</th>
                            <td class="col-data" colspan="2">${clsDisplay}</td>
                            <th class="col-header">活性</th><td class="col-data">${active}</td>
                            <th class="col-header">種類</th><td class="col-data">${type}</td>
                            <th class="col-header">性向</th><td class="col-data">${align}</td>
                        </tr>
                        <tr>
                            <th class="col-header">消耗MP</th><td class="col-data">${mp}</td>
                            <th class="col-header">消耗HP</th><td class="col-data">${hp}</td>
                            <th class="col-header">材料・触媒</th><td class="col-data" colspan="3">${material}</td>
                            <th class="col-header">持続時間</th><td class="col-data" colspan="3">${duration}</td>
                        </tr>
                        <tr>
                            <th class="col-header">対象</th><td class="col-data" colspan="2">${target}</td>
                            <th class="col-header">再使用時間</th><td class="col-data">${reuse}</td>
                            <th class="col-header">効果・性能</th><td class="col-data" colspan="7">${effect}</td>
                        </tr>
                        <tr>
                            <th class="col-header">習得Lv.</th><td class="col-data">${acqLv}</td>
                            <th class="col-header">取得方法</th><td class="col-data" colspan="3">${obtain}</td>
                            <th class="col-header">価格</th><td class="col-data" colspan="5">${price}</td>
                        </tr>
                        <tr>
                            <th class="col-header">ドロップ</th><td class="col-data" colspan="10">${Droporigin}</td>
                        </tr>
                        <tr>
                            <th class="col-header">【蘇生】</th><td class="col-data" colspan="10">${Dropcomp}</td>
                        </tr>
                        <tr>
                            <th class="col-header">備考1</th><td class="col-data" colspan="5">${note1}</td>
                            <th class="col-header">備考2</th><td class="col-data" colspan="4">${note2}</td>
                        </tr>`
            }
            html +=`</tbody>`;
        }
        html += `</table>`;
        document.getElementById('result').innerHTML = html;
// テーブル描画後
// クラスフィルタリングの初期化
        document.querySelectorAll('.class-btn').forEach(btn => {
            btn.classList.remove('active'); // すべてのボタンからアクティブクラスを削除
        });
        document.querySelector('.class-btn[data-cls="君"]').classList.add('active'); // 初期状態で「君」ボタンをアクティブにする
        document.querySelectorAll('.record-table').forEach(tr => {
            tr.style.display = ''; // 初期状態で全ての行を表示
        });
// クラスフィルタリングのイベントリスナーを追加
    document.querySelectorAll('.class-btn').forEach(btn => {
// 各ボタンにクリックイベントリスナーを追加
        btn.addEventListener('click', function() {
// クリックされたボタンのクラスを取得
            document.querySelectorAll('.class-btn').forEach(b => b.classList.remove('active'));
// すべてのボタンからアクティブクラスを削除
            // クリックされたボタンにアクティブクラスを追加
            this.classList.add('active');
            const selected = this.dataset.cls;
// クリックされたボタンのデータ属性からクラス名を取得
// 選択されたクラスに基づいて行をフィルタリング
        // 選択されたクラスに基づいて行をフィルタリング
            document.querySelectorAll('.record-table').forEach(tr => {
            // 各行に対して表示/非表示を設定
            // tr.dataset.clsは行のdata-cls属性からクラス名を取得
                //if (selected === 'all' || tr.dataset.cls === selected) {
            // tr.dataset.cls に selected の文字列が含まれるかチェック
                if (selected === 'all' || tr.dataset.cls.includes(selected)) {
                    tr.style.display = '';
                } else {
                    tr.style.display = 'none';
                }
            });
            document.querySelectorAll('.record-table').forEach(tr => {
                // tr.dataset.cls に selected の文字列が含まれるかチェック
                if (selected === 'all' || tr.dataset.cls.includes(selected)) {
                    tr.style.display = '';
                } else {
                    tr.style.display = 'none';
                }
});
        });
    });
// クラスコードマップ(url用/数字は公式webページのClassID)
const classCodeMap = {
  "君": "pri",  //0/君主prince・princess
  "騎": "kni",  //1/ナイトknight
  "妖": "elf",  //2/エルフelf
  "魔": "wiz",  //3/ウィザードwizard
  "闇": "dak",  //4/ダークエルフdarkelf
  "竜": "dra",  //5/ドラゴンナイトdragonknight
  "幻": "ill",  //6/イリュージョニストillusionist
  "闘": "war",  //7/ウォリアーwarrior
  "剣": "fen",  //8/フェンサーFencer
  "槍": "lan",  //9/ランサーlancer
  "聖": "Pal"   //10/パラディンPaladin
};
// クラスコード取得関数
function getClassCode(label) {
  return classCodeMap[label] || "etc"; // 未定義なら仮のフォールバック
}// クラスフィルタリング関数
document.querySelectorAll('.class-btn').forEach(btn => {
    btn.addEventListener('click', function () {
        const label = this.dataset.cls; // たとえば "聖"
        const code = getClassCode(label); // たとえば "hol"
        history.replaceState(null, null, `#class=${code}`);
        filterByClass(code); // 既存の注出関数
    });
});
    // reader.readAsText(e.target.files[0], 'UTF-8');
    console.log(text); // デバッグ用
        })
        .catch(error => {
            document.getElementById('result').textContent = '読み込み失敗: ' + error;
        });
    // ここでaddEventListenerの関数を閉じる
});
</script>
</body>
</html>