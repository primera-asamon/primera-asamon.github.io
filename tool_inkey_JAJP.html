<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>キー押下表示</title>
    <link rel="stylesheet" href="stylesheet/Lineage_main.css">
    <style>
        #output {
            font-size: 24px;
            margin-top: 20px;
        }
        .highlight {
            background-color: yellow;
        }
/* ナビゲーションバー（tools共通）*/
			.nav-group_tools {
				margin: 0;
				padding: 0;
				display: -moz-inline-stack;
				display: inline-block;
				vertical-align: middle;
				/*vertical-align: auto;*/
				zoom: 1;
				font-size: 0.9em;
				/*display: inline;*/
			}
			.nav-group_tools>li {
				margin: 0;
				padding: 0 6px;
				display: -moz-inline-stack;
				display: inline-block;
				vertical-align: middle;
				/*vertical-align: auto;*/
				zoom: 1;
				/*display: inline;*/
			}
			.nav-group_tools>li a {
				display: block;
				padding: 6px 6px;
				color: #333;
				text-decoration: none;
			}
			.nav-group_tools>li a:hover {
				color: #e22;
				font-weight:bold;
			}
			.nav-group_tools>li a.active {
				border-bottom: #333 solid 2px;
				color: #999;
			}
    </style>
</head>
<body id="top" class="tool inkey">
  <header> <!-- サイト共通のheaderエリア -->
      <div class="nav"> <!-- site 共通nav -->
        <div class="main-collapsible"> <!-- main-nav 折り畳み -->
          <ul class="nav-group"> <!-- (main nav) -->
            <li><a href="index.html" class="index">ホーム</a></li>
            <li><a href="Lineage_table_monster.html" class="monst">Monsters</a></li>
            <li><a href="Lineage_table_drop.html" class="drop">Drops</a></li>
            <li><a href="Lineage_table_skill.html" class="skill">Skills</a></li>
            <li><a href="Lineage_accessory_crest.html" class="acce">パンドラ装身具</a></li>
            <li><a href="Lineage_remastered_kanji.html" class="kanji">Kanji</a></li>
            <li><a href="Lineage_remastered_etc.html" class="etc">諸表</a></li>
            <li><a href="tool_glyph.html" class="tool">Tools</a></li>
            <li><a href="site_updates.html" class="updt">変更歴</a></li>
          </ul> <!-- (main nav) -->
        </div> <!-- main-nav 折り畳み -->
        <div class="main-toggle"> <!-- main-nav の帯 -->
          <span class="main-toggle-label">
            リネージュメモ<span class="arrow">▼</span>メニュー
          </span>
        </div>
        <div class="subnav-collapsible accessory-only"> <!-- sub-nav 折り畳み（装身具ページだけ表示） -->
          <ul class="nav-group_acce">
            <li><a href="Lineage_accessory_crest.html" class="crest">紋章</a></li>
            <li><a href="Lineage_accessory_insignia.html" class="insig">インシグニア</a></li>
            <li><a href="Lineage_accessory_earring.html" class="ear">イアリング</a></li>
            <li><a href="Lineage_accessory_pendant__page1.html" title="闘士/射手/賢者" class="pend1">ペンダント1</a></li>
            <li><a href="Lineage_accessory_pendant__page2.html" title="ハンター/守護" class="pend2">ペンダント2</a></li>
            <li><a href="Lineage_accessory_bracelet.html" class="brace">ブレスレット</a></li>
            <li><a href="Lineage_accessory_ring__page1.html" title="知恵/勇士/魔法抵抗/体力" class="ring1">リング1</a></li>
            <li><a href="Lineage_accessory_ring__page2.html" title="集中/マナ/回復" class="ring2">リング2</a></li>
          </ul> <!-- (sub nav) accessory 共通nav -->
        </div> <!-- sub-nav 折り畳み（装身具ページだけ表示） -->
        <div class="subnav-toggle accessory-only"> <!-- sub-nav の帯（装身具ページだけ表示） -->
          <span class="subnav-toggle-label">
            パンドラ装身具<span class="arrow">▼</span>メニュー
          </span>
        </div>
			<ul class="nav-group_tools"><!-- (sub nav) tools 共通 -->
				<li><a href="tool_glyph.html" class="font">大字</a></li>
				<li><a href="tool_inkey_JAJP.html" class="inkey">押下釦</a></li>
			</ul> <!-- (sub nav) tools 共通nav -->
		</div> <!-- site 共通nav -->
		<h1>キー押下表示ページ</h1>
		<!-- <div class="header-description"> --><!-- サイト共通のheader説明文エリア -->
		<!-- </div> --><!-- サイト共通のheader説明文エリア -->
	</header> <!-- サイト共通のheaderエリア -->
	<div class="content">
    <div class="article">
			<p>ShiftキーやCtrlキーなどを押し続けてください。</p>
			<label for="layout">キーボードレイアウト:</label>
			<select id="layout">
				<option value="JP">JP</option>
				<option value="US">US</option>
			</select>
			<input type="radio" name="trap" id="start-trap" value="start"> 判定
			<input type="radio" name="trap" id="stop-trap" value="stop" checked> 終了
			<div id="output">押されたキーがここに表示されます。</div>
		</div>
	</div>
    <footer><!-- サイト共通のフッター -->
      <div class="footer-toggle" data-target="footer" data-class="open">
        <span class="footer-toggle-label">
          copyright… <span class="arrow">▼</span>
        </span>
      </div>
      <div class="footer-collapsible"> <!-- 展開表示 -->
        <div class="footer-nav">
          <ul class="footer-nav-group">
            <li>
              <a href="https://x.com/AsamonPrimera" aria-label="当サイトの X（旧Twitter）公式連絡先"><img src="./picture/icons/X_icon.png" width="16" height="16" alt=""></a>
            </li>
          </ul>
        </div> <!-- class="footer-nav"の終わり -->
        <div class="footer-text">
          当サイトで使用されているリネージュの画像・BGM及びその他の表現物の権利は下記のとおり権利者に帰属します：<br>
          Lineage and Lineage Eternal Life are registered trademarks of NCsoft Corporation. 1998-2011 Copyright NCsoft Corporation.<br>
          NC Japan K.K. was granted by NCsoft Corporation the right to publish, distribute, and transmit Lineage Eternal Life in Japan. All Rights Reserved.
        </div>
      </div>
    </footer><!-- サイト共通のフッター -->
	<script>
			let isTrapping = false;
			let pressedKeys = new Set();
			let output = document.getElementById('output');
			let keyMap = {};
			let selectedLayout = 'JP';

			async function loadKeyMap() {
				const response = await fetch('./json/keymap.json');
				keyMap = await response.json();
			}

			loadKeyMap();

			document.getElementById('layout').addEventListener('change', function(event) {
					selectedLayout = event.target.value;
			});

			document.getElementById('start-trap').addEventListener('click', function() {
					isTrapping = true;
			});

			document.getElementById('stop-trap').addEventListener('click', function() {
					isTrapping = false;
					pressedKeys.clear();
					updateOutput();
			});

			window.addEventListener('beforeunload', function() {
					isTrapping = false;
			});

			document.addEventListener('keydown', function(event) {
					if (!isTrapping) return;

					event.preventDefault();

					if (event.key === 'Control' || event.key === 'Shift' || event.key === 'Alt' || event.key.length === 1) {
							pressedKeys.add(event.key);
					}

					updateOutput(event);
			});

			document.addEventListener('keyup', function(event) {
					if (!isTrapping) return;

					if (event.key === 'Control' || event.key === 'Shift' || event.key === 'Alt') {
							pressedKeys.delete(event.key);
					} else {
							pressedKeys.clear();
					}

					updateOutput();
			});

			function updateOutput(event) {
					let keys = Array.from(pressedKeys).map(key => keyMap[selectedLayout][key] || key);
					let locationText = '';

					if (event) {
							if (event.location === KeyboardEvent.DOM_KEY_LOCATION_LEFT) {
									locationText = ' (左)';
							} else if (event.location === KeyboardEvent.DOM_KEY_LOCATION_RIGHT) {
									locationText = ' (右)';
							}
					}

					if (keys.length > 0) {
							output.textContent = `Keys pressed: ${keys.join(' + ')}${locationText}`;
							output.classList.add('highlight');
							setTimeout(() => {
									output.classList.remove('highlight');
							}, 500); // 500ms後にハイライトを解除
					} else {
							output.textContent = '押されたキーがここに表示されます。';
					}
			}
			async function loadKeyMap() {
			try {
			const response = await fetch('./json/keymap.json');
			if (!response.ok) {
					throw new Error('Network response was not ok');
			}
			keyMap = await response.json();
			} catch (error) {
			console.error('Failed to load key map:', error);
			}
			}
			document.getElementById('layout').addEventListener('change', function(event) {
			selectedLayout = event.target.value;
			console.log('Selected layout:', selectedLayout);
			});

			document.getElementById('start-trap').addEventListener('click', function() {
			isTrapping = true;
			console.log('Trapping started:', isTrapping);
			});

			document.getElementById('stop-trap').addEventListener('click', function() {
			isTrapping = false;
			console.log('Trapping stopped:', isTrapping);
			pressedKeys.clear();
			updateOutput();
			});

      document.querySelector('.footer-toggle')
        .addEventListener('click', () => {
          document.querySelector('.footer-collapsible').classList.toggle('open');
          document.querySelector('.footer-toggle').classList.toggle('open');
      });

      document.querySelector('.main-toggle')
        .addEventListener('click', () => {
          document.querySelector('.main-collapsible').classList.toggle('open');
          document.querySelector('.main-toggle').classList.toggle('open');
      });

      document.querySelector('.subnav-toggle')
        .addEventListener('click', () => {
          document.querySelector('.subnav-collapsible').classList.toggle('open');
          document.querySelector('.subnav-toggle').classList.toggle('open');
      });
	</script>
</body>
</html>
